/*!
jQuery plug-in SSsort table-sorter/pager V.0.6
(C) 2014-2019 Tom Phane
License: GNU Affero GPL V.3 or later
*/
!function($){$.fn.SSsort=function(r){var o={table:null,header:null,body:null,rows:null,sortcol:null,sortdata:[],currentpage:1,pagecount:1,works:[]};return this.each(function(){var i=$.extend(o,$.fn.SSsort.defaults,r||{});i.table=this;var c=$(this);i.header=c.children("thead"),i.body=c.children("tbody"),i.rows=i.body[0].rows,i.works=[];var d=i.header.find("tr:first > th"),u=$.fn.jquery,f=$.fn.metadata,m=0;if(d.each(function(){var s=$(this),a=s.hasClass("nosort");if(!a&&f&&!1===s.metadata().sss&&(a=!0),!a){var r=function(s,a){var r=!1;if($.fn.metadata){var n=$(s).metadata().sss;if(!1===n)return!1;n&&(r=function(s){for(var a=t,r=e.length,n=s.toLowerCase(),l=a;l<r;l++)if(e[l].id.toLowerCase()===n)return e[l];for(l=0;l<a;l++)if(e[l].id.toLowerCase()===n)return e[l];return!1}(n))}if(!r){var o=s.cellIndex;r=function(s,a){var r,n,o=!1,i=a.rows,c=0;for(;!1===o&&(r=i[c]);)n=r.cells[s],""===(o=$.trim(l(n)))&&(o=!1),c++;if(!1!==o){for(var d=t,u=e.length,f=d;f<u;f++)if(e[f].is(o,n,a))return e[f];for(f=1;f<d;f++)if(e[f].is(o,n,a))return e[f]}return e[0]}(o,a)}return r}(this,i);r&&(i.works[m]={parser:r,dirty:!0,_map:[]},i.rows.length>1&&i.sortClass&&s.addClass(i.sortClass),u>="1.7"?s.on("click",n):s.bind("click",n))}m++}),$.data(this,"SSsortcfg",i),null!==i.firstsort){var g=d.eq(i.firstsort-1),h=g.hasClass("nosort");!h&&f&&!1===g.metadata().sss&&(h=!0),h?i.firstsort=null:g.trigger("click")}null===i.firstsort&&i.paginate&&(s(i),a(0,i),i.countid&&$("#"+i.countid).html(i.pagecount))}),this},$.fn.SSsort.defaults={sortClass:null,ascClass:null,descClass:null,evenClass:null,oddClass:null,evensortClass:null,oddsortClass:null,firstsort:null,sortdesc:!1,paginate:!1,pagesize:20,currentid:null,countid:null,onSorted:null};var e=[{id:"text",is:function(e){return!0},format:function(e){return $.trim(e)},type:"text"},{id:"number",is:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},format:function(e){if(e){var t=Number(e);return isNaN(t)?Number.NEGATIVE_INFINITY:t}return(e+"").length>0?0:Number.POSITIVE_INFINITY},type:"numeric"},{id:"isoDate",is:function(e){return/^[12]\d{3}[\/-][01]\d[\/-]\[0-3]\d$/.test(e)},format:function(e){return Date.parse(e.replace(/-/g,"/"))},type:"numeric"}],t=e.length;function s(e){e.pagecount=1+(e.rows.length/e.pagesize|0)}function a(e,t){var s=parseInt(t.pagesize,10);t.currentid&&(t.currentpage=s<1?1:1+(e/s|0),$("#"+t.currentid).html(t.currentpage));var a=t.rows;s<1&&(s=a.length+1);for(var r=e+s,n=0;n<a.length;n++)a[n].style.display=n>=e&&n<r?"":"none"}function r(e){for(var t,s,a=e.works[e.sortcol],r=a.parser.format,n=e.rows,o=n.length,i=e.sortcol,c=[],d=0;d<o;d++)t=n[d].cells[i],c[d]=[r(l(t),t,e),d];s="text"===a.parser.type?e.sortdesc?function(e,t){return t[0].localeCompare(e[0])}:function(e,t){return e[0].localeCompare(t[0])}:e.sortdesc?function(e,t){return t[0]-e[0]}:function(e,t){return e[0]-t[0]},a._map=c.sort(s)}function n(e){var t=$(this).closest("table"),n=$.data(t[0],"SSsortcfg");if(!(n.rows.length<2)){var l=this.cellIndex,o=n.header.find("tr:first > th"),i=0;if(l>0)for(var c=0;c<l;c++){var d=o[c];if(d.hasAttribute("colspan")){var u=d.getAttribute("colspan");i+=parseInt(u,10)||1}else i++}var f,m,g=null;i===n.sortcol?(f=n.sortdesc?n.descClass:n.ascClass,n.sortdesc=!n.sortdesc,m=n.sortdesc?n.descClass:n.ascClass,f&&o.eq(i).removeClass(f),m&&o.eq(i).addClass(m),$(n.table).trigger("beforetablesort",{column:i,direction:n.sortdesc}),n.works[i].dirty?r(n):n.works[i]._map.reverse()):(null!==n.sortcol?(g=n.sortcol,(f=n.sortdesc?n.descClass:n.ascClass)&&o.eq(g).removeClass(f),n.sortClass&&(o.eq(i).removeClass(n.sortClass),o.eq(g).addClass(n.sortClass)),n.ascClass&&o.eq(i).addClass(n.ascClass),n.sortdesc=!1):(n.sortClass&&o.eq(i).removeClass(n.sortClass),(m=n.sortdesc?n.descClass:n.ascClass)&&o.eq(i).addClass(m)),n.sortcol=i,$(n.table).trigger("beforetablesort",{column:i,direction:n.sortdesc}),r(n)),setTimeout(function(){var e,t,r,l,o=!!n.oddClass&&new RegExp("(^|\\s+)"+n.oddClass+"(?!\\S)"),c=!!n.evenClass&&new RegExp("(^|\\s+)"+n.evenClass+"(?!\\S)"),u=!!n.oddClass&&new RegExp("(^|\\s+)"+n.oddsortClass+"(?!\\S)"),f=!!n.evenClass&&new RegExp("(^|\\s+)"+n.evensortClass+"(?!\\S)"),m=n.body[0],h=m.parentNode,p=m.nextSibling,v=n.rows,C=v.length,N=n.works[i]._map;h.removeChild(m);for(var b=0;b<C;b++)for(e=v[r=N[b][1]],d=e.cells[i],m.appendChild(e),b%2?(o&&(e.className=e.className.replace(o,"")),c&&!e.className.match(c)&&(e.className=e.className+" "+n.evenClass),u&&(d.className=d.className.replace(u,"")),f&&!d.className.match(f)&&(d.className=d.className+" "+n.evensortClass)):(c&&(e.className=e.className.replace(c,"")),o&&!e.className.match(o)&&(e.className=e.className+" "+n.oddClass),f&&(d.className=d.className.replace(f,"")),u&&!d.className.match(u)&&(d.className=d.className+" "+n.oddsortClass)),null!==g&&(t=e.cells[g],u&&(t.className=t.className.replace(u,"")),f&&(t.className=t.className.replace(f,""))),N[b][1]=b,l=b+1;l<C;l++)N[l][1]>r&&N[l][1]--;h.insertBefore(m,p),n.body=$(n.table).children("tbody"),n.rows=m.rows,n.works[i].dirty=void 0!==n.works[i].parser.watch&&n.works[i].parser.watch,n.paginate&&(n.currentpage=1,s(n),a(0,n),n.countid&&$("#"+n.countid).html(n.pagecount)),$(n.table).trigger("aftertablesort",{column:i,direction:n.sortdesc}),$.isFunction(n.onSorted)&&n.onSorted.call(n.table)},20)}}function l(e){for(;e.hasChildNodes();)e=e.firstChild;var t=e.nodeValue;return"#text"===e.nodeName&&""===$.trim(t)&&null!==(e=e.nextElementSibling)&&(t=e.nodeValue),t||!1}$.fn.SSsort.movePage=function(e,t,s){var r=$.data(e,"SSsortcfg");if(r){var n=t?s?r.pagecount:r.currentpage+1:s?1:r.currentpage-1;n>0&&n<=r.pagecount&&(r.currentpage=n,a((n-1)*r.pagesize,r))}},$.fn.SSsort.setCurrent=function(e,t,r){var n=$.data(e,"SSsortcfg");if(n){n[t]=r,n.countid&&s(n);var l=0;"currentpage"===t&&r>0&&(l=r-1),a(l,n),n.countid&&$("#"+n.countid).html(n.pagecount)}},$.fn.SSsort.mapTable=function(e){var t={},s=1;return $(e).find("tr").each(function(){var e=this.getAttribute("id")||this.getAttribute("name")||"row"+s,a={},r=1;$(this).each(function(){var e=[];$(this).children().each(function(){e[e.length]=this.hasAttribute("value")?this.getAttribute("value"):$(this).text()});var t=this.getAttribute("id")||this.getAttribute("name")||"col"+r;switch(e.length){case 0:a[t]="<empty>";break;case 1:a[t]=e[0];break;default:for(var s={},n=0;n<e.length;++n)s[n]=e[n];a[t]=s}r++}),t[e]=a,s++}),t},$.fn.SSsort.addParser=function(t,s){for(var a=e.length,r=t.id.toLowerCase(),n=0;n<a;n++)if(e[n].id.toLowerCase()===r)return void(s&&(e[n]=t));e[a]=t},$.fn.SSsort.formatFloat=function(e){var t=parseFloat(e);return isNaN(t)?Number.NEGATIVE_INFINITY:t},$.fn.SSsort.formatInt=function(e){var t=parseInt(e,10);return isNaN(t)?Number.NEGATIVE_INFINITY:t}}(jQuery);
